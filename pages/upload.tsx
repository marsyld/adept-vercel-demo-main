import { useState } from 'react'; export default function Upload(){ const [id,setId]=useState<string>(); const [file,setFile]=useState<File|null>(null); const [status,setStatus]=useState('idle'); async function create(){ const r=await fetch('/api/analyses',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+localStorage.getItem('token')}}); const j=await r.json(); setId(j.id); setStatus(j.status); } async function upload(){ if(!id||!file) return; const r1=await fetch('/api/analyses/'+id+'/upload-url',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+localStorage.getItem('token')},body:JSON.stringify({ext:'jpg',contentType:file.type||'image/jpeg'})}); await r1.json(); setStatus('ready'); } async function submit(){ if(!id) return; await fetch('/api/analyses/'+id+'/submit',{method:'POST',headers:{'Authorization':'Bearer '+localStorage.getItem('token')}}); setStatus('done'); } return (<main style={{maxWidth:960,margin:'40px auto',padding:'0 20px'}}><h1>Загрузка фото</h1><p><button onClick={create}>Создать анализ</button></p><p><input type='file' accept='image/*' onChange={e=>setFile(e.target.files?.[0]||null)}/> <button disabled={!id||!file} onClick={upload}>Загрузить «До»</button></p><p><button disabled={!id} onClick={submit}>Отправить в обработку</button> {id && <a href={'/report/'+id} style={{marginLeft:10}}>Отчёт</a>}</p><div>id: {id||'-'}; status: {status}</div></main>); }